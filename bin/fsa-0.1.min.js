(function(a){if(a.hasOwnProperty("fsa")){return}var b={};b.State=function(c,d){this.FQN="State";this.name="";this.parent="";this.isInitial=false;this._actions={};this._guards={};this._transitions={};this._parseName(c);if(d){if(d.isInitial){this.isInitial=true}if(d.guards){if(d.guards.enter){this._addCallbacks(this._guards,"enter",d.guards.enter)}if(d.guards.exit){this._addCallbacks(this._guards,"exit",d.guards.exit)}}if(d.actions){if(d.actions.enter){this._addCallbacks(this._actions,"enter",d.actions.enter)}if(d.actions.exit){this._addCallbacks(this._actions,"exit",d.actions.exit)}}if(d.parent){this.parent=d.parent}if(d.transitions){this._addTransitions(d.transitions)}this._addTransitions(d,b.State._configMembers)}};b.State._events=["enter","exit"];b.State._configMembers=["isInitial","guards","actions","parent","transitions"];b.State.prototype={addTransition:function(c,d){if(!c||typeof c!="string"){throw new Error(1040)}if(!d||typeof d!="string"){throw new Error(1041)}this._transitions[c]=d;return this},removeTransition:function(c){delete this._transitions[c];return this},getTransition:function(c){return this._transitions[c]},hasTransition:function(c){return this._transitions.hasOwnProperty(c)},addAction:function(c,d){if(b.State._events.indexOf(c)<0){throw new Error(1060)}if(!d||typeof d!="function"){throw new Error(1061)}this._addCallback(this._actions,c,d);return this},hasAction:function(c,d){return this._getCallbackIndex(this._actions,c,d)>=0},removeAction:function(c,d){this._removeCallback(this._actions,c,d);return this},addGuard:function(c,d){if(b.State._events.indexOf(c)<0){throw new Error(1070)}if(!d||typeof d!="function"){throw new Error(1071)}this._addCallback(this._guards,c,d);return this},hasGuard:function(c,d){return this._getCallbackIndex(this._guards,c,d)>=0},removeGuard:function(c,d){this._removeCallback(this._guards,c,d);return this},destroy:function(){this._actions=undefined;this._guards=undefined;this._parent=undefined;this._transitions=undefined;this.name=undefined;return this},_parseName:function(d){var c=d.lastIndexOf("/");if(c>=0){this.parent=d.substring(0,c)}this.name=d},_executeActions:function(d,g,c){var e,j,h,f;if(this._actions.hasOwnProperty(d)){f={event:d,from:g.name,to:c.name};for(e=0,j=this._actions[d].length;e<j;e++){h=this._actions[d][e];h.call(this,f)}}},_executeGuards:function(d,g,c){var e,j,f,h;if(this._guards.hasOwnProperty(d)){f={event:d,from:g.name,to:c.name};for(e=0,j=this._guards[d].length;e<j;e++){h=this._guards[d][e];if(!h.call(this,f)){return false}}}return true},_getCallbackIndex:function(c,d,e){if(c&&c.hasOwnProperty(d)){return c[d].indexOf(e)}return -1},_addCallbacks:function(f,c,e){var d,g;if(typeof e=="function"){this._addCallback(f,c,e)}else{for(d=0,g=e.length;d<g;d++){this._addCallback(f,c,e[d])}}},_addCallback:function(d,c,e){if(!d.hasOwnProperty(c)){d[c]=[]}if(d[c].indexOf(e)<0){d[c].push(e)}},_removeCallback:function(c,d,f){var e=this._getCallbackIndex(c,d,f);if(e>=0){c[d].splice(e,1)}},_addTransitions:function(e,d){var c;for(c in e){if(e.hasOwnProperty(c)){if(d&&d.indexOf(c)>=0){continue}this.addTransition(c,e[c])}}}};b._Node=function(c){this.state=c;this.parent=undefined;this.children=undefined;this.initialChild=undefined};b._Node.prototype={addChild:function(c){if(!this.children){this.children={}}c.parent=this;if(c.state.isInitial){this.initialChild=c}this.children[c.state.name]=c},removeChild:function(c){if(this.initialChild===c){this.initialChild=undefined}delete this.children[c.state.name]},destroy:function(){var c;for(c in this.children){if(this.children.hasOwnProperty(c)){this.children[c].destroy()}}this.state=undefined;this.parent=undefined;this.children=undefined},getInitialBranch:function(){var c=[],d=this.initialChild;while(d){c.push(d);d=d.initialChild}return c}};b.Automaton=function(c){this._nodes={};this._rootNode=new b._Node(new b.State("*"),true);this._currentBranch=[this._rootNode];if(c){this.parse(c)}};b.Automaton.prototype={FQN:"Automaton",getRootState:function(){return this._rootNode.state},getCurrentState:function(){return this._currentBranch[this._currentBranch.length-1].state},createState:function(e,c){var d=new b.State(e,c);this.addState(d);return this},addState:function(e){var d,c;if(!this.hasState(e.name)){d=new b._Node(e);c=(e.parent)?this._nodes[e.parent]:this._rootNode;c.addChild(d);if(e.isInitial&&c.state==this.getCurrentState()){this._currentBranch.push(d)}this._nodes[e.name]=d}return this},hasState:function(c){return this._nodes.hasOwnProperty(c)},getState:function(c){if(this.hasState(c)){return this._nodes[c].state}return undefined},removeState:function(f){var e,c,d;if(this.hasState(f)){e=this._nodes[f];c=e.parent;c.removeChild(e);d=this._currentBranch.indexOf(e);if(d>=0){this._currentBranch.splice(d,this._currentBranch.length-d)}e.destroy();delete this._nodes[f]}return this},doTransition:function(c){var l,h,f,g,e,m,k,j,d;for(h=this._currentBranch.length-1,f=0;h>=f;h--){l=this._currentBranch[h].state;if(l.hasTransition(c)){break}}if(h>=0){g=this._nodes[l.getTransition(c)];if(g){e=this._getFullBranch(g);m=this._getShortestRoute(this._currentBranch,e);k=[this.getCurrentState(),g.state];j=this._applyToEachNode(m.up,b.State.prototype._executeGuards,["exit"].concat(k),true);if(j){d=g.getInitialBranch();j=this._applyToEachNode(m.down.concat(d),b.State.prototype._executeGuards,["enter"].concat(k),true)}if(j){this._applyToEachNode(m.up,b.State.prototype._executeActions,["exit"].concat(k),false);this._applyToEachNode(m.down,b.State.prototype._executeActions,["enter"].concat(k),false);this._currentBranch=e.concat(d)}}}},parse:function(d){var c;for(c in d){if(d.hasOwnProperty(c)){this.createState(c,d[c])}}},destroy:function(){this._rootNode.destroy();this._rootNode=undefined;this._nodes=undefined;this._currentStateBranch=undefined},_getFullBranch:function(d){var c=[];do{c.unshift(d);d=d.parent}while(d);return c},_getShortestRoute:function(f,e){var d,h,c,g;for(d=0,h=Math.min(f.length,e.length);d<h;d++){if(f[d]!==e[d]){break}}c=f.slice(d).reverse();g=e.slice(d);return{up:c,down:g}},_applyToEachNode:function(c,k,d,g){var f=true,e,j,h;if(g==undefined){g=false}for(e=0,j=c.length;(!g||f)&&e<j;e++){h=c[e].state;f=k.apply(h,d)}return f}};a.fsa=b}(this));