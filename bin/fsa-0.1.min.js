(function(a){if(a.hasOwnProperty("fsa")){return}var b={};b._Dispatcher=function(){this._listeners={}};b._Dispatcher.prototype={addListener:function(c,d){if(!this._listeners.hasOwnProperty(c)){this._listeners[c]=[]}this._listeners[c].push(d);return this},addListeners:function(d,c){if(!this._listeners.hasOwnProperty(d)){this._listeners[d]=[]}this._listeners[d].concat(c);return this},hasListener:function(c,d){return(this._listeners.hasOwnProperty(c)&&this._listeners[c].indexOf(d>=0))},removeListener:function(c,e){if(this._listeners.hasOwnProperty(c)){var d=this._listeners[c].indexOf(e);if(d>=0){this._listeners[c].splice(d,1)}}return this},dispatch:function(h){var c=h.type;if(this._listeners.hasOwnProperty(c)){var d=Array.prototype.slice.call(arguments);for(var f=0,j=this._listeners[c].length;f<j;f++){var g=this._listeners[c][f];g.apply(this,d)}}},dispatchUntilFalseOrFinished:function(h){var c=h.type;if(this._listeners.hasOwnProperty(c)){var d=Array.prototype.slice.call(arguments);for(var f=0,j=this._listeners[c].length;f<j;f++){var g=this._listeners[c][f];if(!g.apply(this,d)){return false}}}return true}};b.State=function(c,d){this.FQN="State";this.name="";this.parent="";this.isInitial=false;this._isTransitioning=false;this._actions=undefined;this._guards=undefined;this._transitions={};this._parseName(c);if(d){if(d.isInitial){this.isInitial=true}if(d.guards){if(d.guards.enter){this._guards=this._addCallbacksList(this._guards,"enter",d.guards.enter)}if(d.guards.exit){this._guards=this._addCallbacksList(this._guards,"exit",d.guards.exit)}}if(d.actions){if(d.actions.enter){this._actions=this._addCallbacksList(this._actions,"enter",d.actions.enter)}if(d.actions.exit){this._actions=this._addCallbacksList(this._actions,"exit",d.actions.exit)}}if(d.parent){this.parent=d.parent}if(d.transitions){this._addTransitions(d.transitions)}this._addTransitions(d,b.State._configMembers)}};b.State._events=["enter","exit"];b.State._configMembers=["isInitial","guards","actions","parent","transitions"];b.State.prototype={isTransitioning:function(){return this._isTransitioning},halt:function(){this._isTransitioning=true},addTransition:function(c,d){if(!c||typeof c!=="string"){throw new Error(1040)}if(!d||typeof d!=="string"){throw new Error(1041)}this._transitions[c]=d;return this},removeTransition:function(c){delete this._transitions[c];return this},getTransition:function(c){return this._transitions[c]},hasTransition:function(c){return this._transitions.hasOwnProperty(c)},addAction:function(c,d){this._actions=this._addCallback(this._actions,c,d);return this},addActionsList:function(c,d){this._actions=this._addCallbacksList(this._actions,c,d);return this},hasAction:function(c,d){return this._hasCallback(this._actions,c,d)},removeAction:function(c,d){this._removeCallback(this._actions,c,d);return this},addGuard:function(c,d){this._guards=this._addCallback(this._guards,c,d);return this},addGuardsList:function(c,d){this._guards=this._addCallbacksList(this._guards,c,d);return this},hasGuard:function(c,d){return this._hasCallback(this._guards,c,d)},removeGuard:function(c,d){this._removeCallback(this._guards,c,d);return this},destroy:function(){this._actions=undefined;this._guards=undefined;this._parent=undefined;this._transitions=undefined;this.name=undefined;return this},_parseName:function(d){var c=d.lastIndexOf("/");if(c>=0){this.parent=d.substring(0,c)}this.name=d},_executeActions:function(){if(this._actions){var c=Array.prototype.slice.call(arguments);b._Dispatcher.prototype.dispatch.apply(this._actions,c)}},_executeGuards:function(){if(this._guards){var c=Array.prototype.slice.call(arguments);return b._Dispatcher.prototype.dispatchUntilFalseOrFinished.apply(this._guards,c)}return true},_addCallback:function(d,c,e){if(d==undefined){d=new b._Dispatcher()}d.addListener(c,e);return d},_addCallbacksList:function(d,c,e){if(d==undefined){d=new b._Dispatcher()}d.addListeners(c,e);return d},_hasCallback:function(d,c,e){return d&&d.hasListener(c,e)},_removeCallback:function(d,c,e){if(d){d.removeListener(c,e)}return d},_addTransitions:function(e,d){for(var c in e){if(e.hasOwnProperty(c)){if(d&&d.indexOf(c)>=0){continue}this.addTransition(c,e[c])}}}};b._Node=function(c){this.state=c;this.parent=undefined;this.children=undefined;this.initialChild=undefined};b._Node.prototype={addChild:function(c){if(!this.children){this.children={}}c.parent=this;if(c.state.isInitial){this.initialChild=c}this.children[c.state.name]=c},removeChild:function(c){if(this.initialChild===c){this.initialChild=undefined}delete this.children[c.state.name]},destroy:function(){for(var c in this.children){if(this.children.hasOwnProperty(c)){this.children[c].destroy()}}this.state=undefined;this.parent=undefined;this.children=undefined},getInitialBranch:function(){var c=[];var d=this.initialChild;while(d){c.push(d);d=d.initialChild}return c}};b.Automaton=function(c){this._nodes={};this._rootNode=new b._Node(new b.State("*"),true);this._currentBranch=[this._rootNode];this._transitioning="ready";this._actionsQueue=[];this._newBranch=undefined;if(c){this.parse(c)}};b.Automaton.prototype={FQN:"Automaton",isTransitioning:function(){return this._transitioning!=="ready"},getRootState:function(){return this._rootNode.state},getCurrentState:function(){return this._currentBranch[this._currentBranch.length-1].state},createState:function(e,c){var d=new b.State(e,c);this.addState(d);return this},addState:function(e){if(!this.hasState(e.name)){var d=new b._Node(e);var c=(e.parent)?this._nodes[e.parent]:this._rootNode;c.addChild(d);if(e.isInitial&&c.state===this.getCurrentState()){this._currentBranch.push(d)}this._nodes[e.name]=d}return this},hasState:function(c){return this._nodes.hasOwnProperty(c)},getState:function(c){if(this.hasState(c)){return this._nodes[c].state}return undefined},removeState:function(f){if(this.hasState(f)){var e=this._nodes[f];var c=e.parent;c.removeChild(e);var d=this._currentBranch.indexOf(e);if(d>=0){this._currentBranch.splice(d,this._currentBranch.length-d)}e.destroy();delete this._nodes[f]}return this},doTransition:function(c){var p;for(var j=this._currentBranch.length-1,f=0;j>=f;j--){p=this._currentBranch[j].state;if(p.hasTransition(c)){break}}if(j>=0){var g=this._nodes[p.getTransition(c)];if(g){this._transitioning="running";var d=g.getInitialBranch();this._newBranch=this._getFullBranch(g).concat(d);var q=this._getShortestRoute(this._currentBranch,this._newBranch);var h=this.getCurrentState().name;var m=g.state.name;var l=Array.prototype.slice.call(arguments);l.shift();var e=[{type:"exit",from:h,to:m}].concat(l);var o=[{type:"enter",from:h,to:m}].concat(l);var k=this._applyToEachNode(q.up,b.State.prototype._executeGuards,e,true);if(k){k=this._applyToEachNode(q.down,b.State.prototype._executeGuards,o,true)}if(k){this._addToActionsQueue(q.up,e);this._addToActionsQueue(q.down,o);this.proceed()}}}},parse:function(d){for(var c in d){if(d.hasOwnProperty(c)){this.createState(c,d[c])}}},proceed:function(){if(this.isTransitioning()){if(this._actionsQueue.length>0){this._transitioning="running";var d=this._actionsQueue.shift();var c=d.node.state;b.State.prototype._executeActions.apply(c,d.args);if(this._transitioning!=="paused"){this.proceed()}}else{this._finishTransition()}}},pause:function(){this._transitioning="paused"},destroy:function(){this._rootNode.destroy();this._rootNode=undefined;this._nodes=undefined;this._currentStateBranch=undefined},_addToActionsQueue:function(c,d){for(var e=0,f=c.length;e<f;e++){this._actionsQueue.push({node:c[e],args:d})}},_finishTransition:function(){this._transitioning="ready";this._currentBranch=this._newBranch;this._newBranch=undefined},_getFullBranch:function(d){var c=[];do{c.unshift(d);d=d.parent}while(d);return c},_getShortestRoute:function(f,e){var d,h=Math.min(f.length,e.length);for(d=0;d<h;d++){if(f[d]!==e[d]){break}}var c=f.slice(d).reverse();var g=e.slice(d);return{up:c,down:g}},_applyToEachNode:function(c,k,d,g){if(g==undefined){g=false}var f=true;for(var e=0,j=c.length;(!g||f)&&e<j;e++){var h=c[e].state;f=k.apply(h,d)}return f}};a.fsa=b}(this));